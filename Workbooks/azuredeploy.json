{
  "contentVersion": "1.0.0.0",
  "parameters": {
    "workbookDisplayName": {
      "type": "string",
      "defaultValue": "MSDX Summaries",
      "metadata": {
        "description": "The friendly name for the workbook that is used in the Gallery or Saved List.  This name must be unique within a resource group."
      }
    },
    "workbookType": {
      "type": "string",
      "defaultValue": "sentinel",
      "metadata": {
        "description": "The gallery that the workbook will been shown under. Supported values include workbook, tsg, etc. Usually, this is 'workbook'"
      }
    },
    "workbookSourceId": {
      "type": "string",
      "defaultValue": "/subscriptions/5332aa87-652c-4714-b0a1-2d2cb3952428/resourcegroups/securityops/providers/microsoft.operationalinsights/workspaces/secops",
      "metadata": {
        "description": "The id of resource instance to which the workbook will be associated"
      }
    },
    "workbookId": {
      "type": "string",
      "defaultValue": "[newGuid()]",
      "metadata": {
        "description": "The unique guid for this workbook instance"
      }
    }
  },
  "resources": [
    {
      "name": "[parameters('workbookId')]",
      "type": "microsoft.insights/workbooks",
      "location": "[resourceGroup().location]",
      "apiVersion": "2022-04-01",
      "dependsOn": [],
      "kind": "shared",
      "properties": {
        "displayName": "[parameters('workbookDisplayName')]",
        "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":11,\"content\":{\"version\":\"LinkItem/1.0\",\"style\":\"tabs\",\"links\":[{\"id\":\"fa58bdde-c76f-4cc2-befd-cd10679e057e\",\"cellValue\":\"currentTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Network\",\"subTarget\":\"Network\",\"style\":\"primary\",\"icon\":\"CloudUpload\"},{\"id\":\"727bf92a-b5ef-4a13-9058-b846462c9c36\",\"cellValue\":\"currentTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Process\",\"subTarget\":\"Process\",\"style\":\"link\",\"icon\":\"CloudUpload\"},{\"id\":\"8479dc9f-94b8-4db0-8559-15c453d97539\",\"cellValue\":\"currentTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Search\",\"subTarget\":\"Search\",\"style\":\"link\"}]},\"name\":\"links - 2\"},{\"type\":1,\"content\":{\"json\":\"---\\n#### Your data, summarized\\n\"},\"name\":\"text - 2\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"0a0ba6a1-c44c-41c9-8be3-332600b8d943\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"TimeRange\",\"label\":\"Time Range\",\"type\":4,\"isRequired\":true,\"typeSettings\":{\"selectableValues\":[{\"durationMs\":14400000},{\"durationMs\":86400000},{\"durationMs\":604800000},{\"durationMs\":2592000000},{\"durationMs\":5184000000},{\"durationMs\":7776000000}],\"allowCustom\":true},\"timeContext\":{\"durationMs\":86400000},\"value\":{\"durationMs\":86400000}},{\"id\":\"c9da3302-3124-4801-a0e1-1be08bc5db61\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"ShowMetrics\",\"label\":\"Show Metrics?\",\"type\":10,\"isRequired\":true,\"typeSettings\":{\"additionalResourceOptions\":[],\"showDefault\":false},\"jsonData\":\"[\\r\\n { \\\"value\\\": \\\"Yes\\\", \\\"label\\\": \\\"Yes\\\"},\\r\\n { \\\"value\\\": \\\"No\\\", \\\"label\\\": \\\"No\\\", \\\"selected\\\":true }\\r\\n]\",\"timeContext\":{\"durationMs\":86400000},\"value\":\"Yes\"}],\"style\":\"above\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - 5\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"Size Estimates of Summarized and Original Data\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let summary=\\nunion SummariesNetworkInbound_CL, SummariesNetworkOutbound_CL, SummariesDeviceNetworkEvents_CL, (SummariesOriginalTableSizeEstimates_CL | where table_s == \\\"Firewall Traffic\\\" or table_s == \\\"DeviceNetworkEvents\\\")\\n\\t\\t| summarize total = toreal(sum(estimate_data_size(*)))\\n\\t\\t| extend type=\\\"Summarized Data\\\";\\nSummariesOriginalTableSizeEstimates_CL\\n\\t\\t| where table_s == \\\"Firewall Traffic\\\" or table_s == \\\"DeviceNetworkEvents\\\"\\n        | summarize total = toreal(sum(total_d))\\n\\t\\t| extend type=\\\"Original Data\\\"\\n\\t\\t| union summary\\n        | render piechart\\n\",\"size\":0,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\",\"chartSettings\":{\"seriesLabelSettings\":[{\"seriesName\":\"Original Data\",\"color\":\"gray\"},{\"seriesName\":\"Summarized Data\",\"color\":\"greenDarkDark\"}],\"ySettings\":{\"numberFormatSettings\":{\"unit\":2,\"options\":{\"style\":\"decimal\",\"useGrouping\":true}}}}},\"customWidth\":\"30\",\"name\":\"Estimated Data Savings from Summarization\",\"styleSettings\":{\"maxWidth\":\"30\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let summaries = range TimeGenerated from {TimeRange:start} to {TimeRange:end} step 1h\\r\\n| project TimeGenerated = bin(TimeGenerated,1h)\\r\\n| join kind=fullouter\\r\\n    (union SummariesNetworkInbound_CL, SummariesNetworkOutbound_CL, SummariesDeviceNetworkEvents_CL, (SummariesOriginalTableSizeEstimates_CL | where table_s == \\\"Firewall Traffic\\\" or table_s == \\\"DeviceNetworkEvents\\\")\\r\\n    | summarize bytes = toreal(sum(estimate_data_size(*))) by bin(TimeGenerated, 1h)) on TimeGenerated\\r\\n| project bytes=iff(isnull(bytes), toreal(0), bytes), TimeGenerated\\r\\n| extend type = \\\"Summary\\\";\\r\\nrange TimeGenerated from {TimeRange:start} to {TimeRange:end} step 1h\\r\\n| project TimeGenerated = bin(TimeGenerated,1h)\\r\\n| join kind=fullouter\\r\\n    (SummariesOriginalTableSizeEstimates_CL\\r\\n        | where table_s == \\\"Firewall Traffic\\\" or table_s == \\\"DeviceNetworkEvents\\\"\\r\\n        | summarize bytes = toreal(sum(total_d)) by bin(TimeGenerated, 1h)) on TimeGenerated\\r\\n        | project bytes=iff(isnull(bytes), toreal(0), bytes), TimeGenerated\\r\\n        | extend type = \\\"Original\\\"\\r\\n    | union summaries\\r\\n    | render timechart \",\"size\":0,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"chartSettings\":{\"seriesLabelSettings\":[{\"seriesName\":\"Original\",\"color\":\"redDark\"},{\"seriesName\":\"Summary\",\"color\":\"greenDarkDark\"}],\"ySettings\":{\"numberFormatSettings\":{\"unit\":2,\"options\":{\"style\":\"decimal\",\"useGrouping\":true}}}}},\"customWidth\":\"70\",\"name\":\"query - 4\",\"styleSettings\":{\"maxWidth\":\"70\"}}]},\"conditionalVisibilities\":[{\"parameterName\":\"currentTab\",\"comparison\":\"isEqualTo\",\"value\":\"Network\"},{\"parameterName\":\"ShowMetrics\",\"comparison\":\"isEqualTo\",\"value\":\"Yes\"}],\"name\":\"Network Metrics\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"Size Estimates of Summarized and Original Data\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let summary=\\nunion SummariesDeviceProcessEvents_CL, (SummariesOriginalTableSizeEstimates_CL | where table_s == \\\"DeviceProcessEvents\\\")\\n\\t\\t| summarize total = toreal(sum(estimate_data_size(*)))\\n\\t\\t| extend type=\\\"Summarized Data\\\";\\nSummariesOriginalTableSizeEstimates_CL\\n\\t\\t| where table_s == \\\"DeviceProcessEvents\\\"\\n        | summarize total = toreal(sum(total_d))\\n\\t\\t| extend type=\\\"Original Data\\\"\\n\\t\\t| union summary\\n        | render piechart\\n\",\"size\":0,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\",\"chartSettings\":{\"seriesLabelSettings\":[{\"seriesName\":\"Original Data\",\"color\":\"gray\"},{\"seriesName\":\"Summarized Data\",\"color\":\"greenDarkDark\"}],\"ySettings\":{\"numberFormatSettings\":{\"unit\":2,\"options\":{\"style\":\"decimal\",\"useGrouping\":true}}}}},\"customWidth\":\"30\",\"name\":\"Estimated Data Savings from Summarization\",\"styleSettings\":{\"maxWidth\":\"30\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let summaries = range TimeGenerated from {TimeRange:start} to {TimeRange:end} step 1h\\r\\n| project TimeGenerated = bin(TimeGenerated,1h)\\r\\n| join kind=fullouter\\r\\n    (union SummariesDeviceProcessEvents_CL, (SummariesOriginalTableSizeEstimates_CL | where table_s == \\\"DeviceProcessEvents\\\")\\r\\n    | summarize bytes = toreal(sum(estimate_data_size(*))) by bin(TimeGenerated, 1h)) on TimeGenerated\\r\\n| project bytes=iff(isnull(bytes), toreal(0), bytes), TimeGenerated\\r\\n| extend type = \\\"Summary\\\";\\r\\nrange TimeGenerated from {TimeRange:start} to {TimeRange:end} step 1h\\r\\n| project TimeGenerated = bin(TimeGenerated,1h)\\r\\n| join kind=fullouter\\r\\n    (SummariesOriginalTableSizeEstimates_CL\\r\\n        | where table_s == \\\"DeviceProcessEvents\\\"\\r\\n        | summarize bytes = toreal(sum(total_d)) by bin(TimeGenerated, 1h)) on TimeGenerated\\r\\n        | project bytes=iff(isnull(bytes), toreal(0), bytes), TimeGenerated\\r\\n        | extend type = \\\"Original\\\"\\r\\n    | union summaries\\r\\n    | render timechart \",\"size\":0,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"chartSettings\":{\"seriesLabelSettings\":[{\"seriesName\":\"Original\",\"color\":\"redDark\"},{\"seriesName\":\"Summary\",\"color\":\"greenDarkDark\"}],\"ySettings\":{\"numberFormatSettings\":{\"unit\":2,\"options\":{\"style\":\"decimal\",\"useGrouping\":true}}}}},\"customWidth\":\"70\",\"name\":\"query - 4\",\"styleSettings\":{\"maxWidth\":\"70\"}}]},\"conditionalVisibilities\":[{\"parameterName\":\"currentTab\",\"comparison\":\"isEqualTo\",\"value\":\"Process\"},{\"parameterName\":\"ShowMetrics\",\"comparison\":\"isEqualTo\",\"value\":\"Yes\"}],\"name\":\"Metrics - Process\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"164c4e18-f65b-4f15-ba2a-982bbcf26573\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"TopRows\",\"label\":\"# of Top IPs\",\"type\":2,\"isRequired\":true,\"typeSettings\":{\"additionalResourceOptions\":[],\"showDefault\":false},\"jsonData\":\"[\\r\\n { \\\"value\\\": \\\"10\\\", \\\"label\\\": \\\"10\\\", \\\"selected\\\":true },\\r\\n { \\\"value\\\": \\\"50\\\", \\\"label\\\": \\\"50\\\"},\\r\\n { \\\"value\\\": \\\"100\\\", \\\"label\\\": \\\"100\\\"}\\r\\n]\",\"timeContext\":{\"durationMs\":86400000},\"value\":\"100\"},{\"id\":\"340cce41-bf6e-4a18-a394-eeadf4820e72\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"IPSearch\",\"label\":\"Search for an IP\",\"type\":1,\"value\":\"\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"conditionalVisibility\":{\"parameterName\":\"currentTab\",\"comparison\":\"isEqualTo\",\"value\":\"Network\"},\"name\":\"parameters - 1\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let devicecounts=\\r\\nSummariesDeviceNetworkEvents_CL\\r\\n| mv-expand todynamic(Actions_s)\\r\\n| extend NumUrls = array_length(todynamic(URLs_s))\\r\\n| summarize count(), NumUrls=max(NumUrls) by RemoteIP_s;\\r\\nunion SummariesNetworkInbound_CL, SummariesNetworkOutbound_CL\\r\\n| where isempty(tostring(\\\"{IPSearch}\\\")) or IP_s == \\\"{IPSearch}\\\"\\r\\n| summarize inbytes = sum(InBytes_d), outbytes = sum(OutBytes_d) by IP_s\\r\\n| extend total_bytes = inbytes+outbytes\\r\\n| top {TopRows} by total_bytes\\r\\n| extend Type = iff(ipv4_is_private(IP_s), \\\"Private\\\", \\\"Public\\\")\\r\\n| join kind=leftouter devicecounts on $left.IP_s == $right.RemoteIP_s\\r\\n| extend EndpointData = iff(count_ >0, \\\"Yes\\\", \\\"No\\\"), UrlFound = iff(NumUrls >0 , \\\"Yes\\\", \\\"No\\\")\\r\\n| sort by total_bytes\\r\\n| project IP=IP_s, BytesToIP = inbytes, BytesFromIP = outbytes, TotalBytes=total_bytes, Type, EndpointData,UrlFound\\r\\n\",\"size\":0,\"title\":\"Top IPs by total traffic: select an IP to see trends\",\"timeContextFromParameter\":\"TimeRange\",\"exportedParameters\":[{\"fieldName\":\"IP\",\"parameterName\":\"IP_s\"},{\"fieldName\":\"EndpointData\",\"parameterName\":\"EndpointData\",\"parameterType\":1}],\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"inbytes\",\"formatter\":8,\"formatOptions\":{\"palette\":\"gray\"},\"numberFormat\":{\"unit\":2,\"options\":{\"style\":\"decimal\"}}},{\"columnMatch\":\"outbytes\",\"formatter\":8,\"formatOptions\":{\"palette\":\"gray\"},\"numberFormat\":{\"unit\":2,\"options\":{\"style\":\"decimal\"}}},{\"columnMatch\":\"total_bytes\",\"formatter\":8,\"formatOptions\":{\"palette\":\"grayBlue\"},\"numberFormat\":{\"unit\":2,\"options\":{\"style\":\"decimal\"}}},{\"columnMatch\":\"BytesToIP\",\"formatter\":8,\"formatOptions\":{\"palette\":\"gray\"},\"numberFormat\":{\"unit\":2,\"options\":{\"style\":\"decimal\"}}},{\"columnMatch\":\"BytesFromIP\",\"formatter\":8,\"formatOptions\":{\"palette\":\"gray\"},\"numberFormat\":{\"unit\":2,\"options\":{\"style\":\"decimal\"}}},{\"columnMatch\":\"TotalBytes\",\"formatter\":8,\"formatOptions\":{\"palette\":\"grayBlue\"},\"numberFormat\":{\"unit\":2,\"options\":{\"style\":\"decimal\"}}},{\"columnMatch\":\"Group\",\"formatter\":1}]},\"tileSettings\":{\"showBorder\":false,\"titleContent\":{\"columnMatch\":\"IP_s\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"inbytes\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}}},\"customWidth\":\"40\",\"name\":\"Top Total Bytes\",\"styleSettings\":{\"maxWidth\":\"30\",\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let starttime = {TimeRange:start};\\r\\nlet endtime = {TimeRange:end};\\r\\nunion SummariesNetworkInbound_CL, SummariesNetworkOutbound_CL\\r\\n| where IP_s == \\\"{IP_s}\\\"\\r\\n| extend type = \\\"Bytes\\\"\\r\\n| make-series  OutBytes = sum(OutBytes_d), InBytes = sum(InBytes_d)  on TimeGenerated from starttime to endtime step 1h by type\\r\\n| project series_add(OutBytes, InBytes), TimeGenerated, type\\r\\n| render timechart\",\"size\":0,\"title\":\"Trend of Selected IP \",\"color\":\"lightBlue\",\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"chartSettings\":{\"seriesLabelSettings\":[{\"seriesName\":\"Out\",\"color\":\"blueDark\"},{\"seriesName\":\"In\",\"color\":\"greenDarkDark\"},{\"seriesName\":\"Bytes\",\"color\":\"grayBlue\"}],\"ySettings\":{\"numberFormatSettings\":{\"unit\":2,\"options\":{\"style\":\"decimal\",\"useGrouping\":true}}}}},\"customWidth\":\"60\",\"conditionalVisibility\":{\"parameterName\":\"IP_s\",\"comparison\":\"isNotEqualTo\"},\"name\":\"Trends of Selected IP\",\"styleSettings\":{\"maxWidth\":\"60\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let networkevents = SummariesDeviceNetworkEvents_CL\\r\\n| extend Processes_SHA1_s = iff(array_length(todynamic(Processes_SHA1_s))<1, array_concat(todynamic(Processes_SHA1_s), todynamic('[\\\"None\\\"]')), Processes_SHA1_s),\\r\\n    URLs_s = iff(array_length(todynamic(URLs_s))<1, array_concat(todynamic(URLs_s), todynamic('[\\\"None\\\"]')), URLs_s),\\r\\n    Users_s = iff(array_length(todynamic(Users_s))<1, array_concat(todynamic(Users_s), todynamic('[\\\"None\\\"]')), Users_s)\\r\\n| mv-expand todynamic(Processes_SHA1_s)\\r\\n| where RemoteIP_s == \\\"{IP_s}\\\"\\r\\n| summarize firstseen = min(TimeGenerated), lastseen=max(TimeGenerated) by URLs_s, tostring(Processes_SHA1_s), TotalSeen_d, DevicesSeen_d, Actions_s, Users_s, RemoteIP_s;\\r\\nSummariesDeviceProcessEvents_CL\\r\\n| project-away  DevicesSeen_d, TotalSeen_d, Users_s\\r\\n| join kind=rightouter networkevents on $left.SHA1_s == $right.Processes_SHA1_s\\r\\n| mv-expand todynamic(URLs_s)\\r\\n| mv-expand todynamic(Users_s)\\r\\n| mv-expand todynamic(Actions_s)\\r\\n| summarize make_set_if(tostring(URLs_s), isnotempty(tostring(URLs_s))),make_set_if(tostring(Users_s), isnotempty(tostring(Users_s))) by tostring(Actions_s), RemoteIP_s, DevicesSeen_d, TotalSeen_d, tostring(Processes_SHA1_s), FileName_s, firstseen, lastseen\\r\\n\",\"size\":0,\"title\":\"Endpoint Information\",\"color\":\"lightBlue\",\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"chartSettings\":{\"seriesLabelSettings\":[{\"seriesName\":\"Out\",\"color\":\"blueDark\"},{\"seriesName\":\"In\",\"color\":\"greenDarkDark\"},{\"seriesName\":\"bytes\",\"color\":\"grayBlue\"}],\"ySettings\":{\"numberFormatSettings\":{\"unit\":2,\"options\":{\"style\":\"decimal\",\"useGrouping\":true}}}}},\"customWidth\":\"100\",\"conditionalVisibilities\":[{\"parameterName\":\"IP_s\",\"comparison\":\"isNotEqualTo\"},{\"parameterName\":\"EndpointData\",\"comparison\":\"isEqualTo\",\"value\":\"Yes\"}],\"name\":\"Processes Reaching out to Selected IP\",\"styleSettings\":{\"maxWidth\":\"100\"}}]},\"conditionalVisibility\":{\"parameterName\":\"currentTab\",\"comparison\":\"isEqualTo\",\"value\":\"Network\"},\"name\":\"Top - IPs\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"164c4e18-f65b-4f15-ba2a-982bbcf26573\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"TopRows\",\"label\":\"# of Top IPs\",\"type\":2,\"isRequired\":true,\"typeSettings\":{\"additionalResourceOptions\":[],\"showDefault\":false},\"jsonData\":\"[\\r\\n { \\\"value\\\": \\\"10\\\", \\\"label\\\": \\\"10\\\", \\\"selected\\\":true },\\r\\n { \\\"value\\\": \\\"50\\\", \\\"label\\\": \\\"50\\\"},\\r\\n { \\\"value\\\": \\\"100\\\", \\\"label\\\": \\\"100\\\"}\\r\\n]\",\"timeContext\":{\"durationMs\":86400000},\"value\":\"100\"},{\"id\":\"340cce41-bf6e-4a18-a394-eeadf4820e72\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"IPExternalSearch\",\"label\":\"Search for an IP\",\"type\":1,\"value\":\"192.168.1.248\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - 1\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{\\\"version\\\":\\\"AzureDataExplorerQuery/1.0\\\",\\\"queryText\\\":\\\"external_table('DeviceNetworkEvents') | where ['time'] > {TimeRange:start} and ['time'] < {TimeRange:end} and (tostring(properties.RemoteIP) == \\\\\\\"{IPExternalSearch}\\\\\\\")\\\",\\\"clusterName\\\":\\\"https://adxcompc1001.centralus.kusto.windows.net/\\\",\\\"databaseName\\\":\\\"adxdata001\\\"}\",\"size\":0,\"title\":\"IP Search - V1\",\"exportedParameters\":[{\"fieldName\":\"IP\",\"parameterName\":\"IP_s\"},{\"fieldName\":\"EndpointData\",\"parameterName\":\"EndpointData\",\"parameterType\":1}],\"queryType\":9,\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"BytesToIP\",\"formatter\":8,\"formatOptions\":{\"palette\":\"gray\"},\"numberFormat\":{\"unit\":2,\"options\":{\"style\":\"decimal\"}}},{\"columnMatch\":\"BytesFromIP\",\"formatter\":8,\"formatOptions\":{\"palette\":\"gray\"},\"numberFormat\":{\"unit\":2,\"options\":{\"style\":\"decimal\"}}},{\"columnMatch\":\"TotalBytes\",\"formatter\":8,\"formatOptions\":{\"palette\":\"grayBlue\"},\"numberFormat\":{\"unit\":2,\"options\":{\"style\":\"decimal\"}}},{\"columnMatch\":\"Group\",\"formatter\":1}],\"rowLimit\":10000},\"tileSettings\":{\"showBorder\":false,\"titleContent\":{\"columnMatch\":\"IP_s\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"inbytes\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}}},\"conditionalVisibility\":{\"parameterName\":\"IPExternalSearch\",\"comparison\":\"isNotEqualTo\"},\"name\":\"IP Search\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{\\\"version\\\":\\\"CustomEndpoint/1.0\\\",\\\"data\\\":\\\"{\\\\r\\\\n        \\\\\\\"Query\\\\\\\": \\\\\\\"external_table('DeviceNetworkEvents') | where ['time'] > {TimeRange:start} and ['time'] < {TimeRange:end} and (tostring(properties.RemoteIP) == '{IPExternalSearch}')\\\\\\\"\\\\r\\\\n    }\\\",\\\"headers\\\":[],\\\"method\\\":\\\"POST\\\",\\\"url\\\":\\\"https://prod-85.eastus.logic.azure.com:443/workflows/606576ab3687476594031dfd361966f3/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=wB0bAnuwMYrVoRKP6qDBSZlkyviayFq-p85UVsNa5B8\\\",\\\"contentType\\\":\\\"application/json\\\",\\\"urlParams\\\":[{\\\"key\\\":\\\"\\\",\\\"value\\\":\\\"\\\"}],\\\"transformers\\\":null}\",\"size\":0,\"title\":\"IP Search - V2\",\"exportedParameters\":[{\"fieldName\":\"IP\",\"parameterName\":\"IP_s\"},{\"fieldName\":\"EndpointData\",\"parameterName\":\"EndpointData\",\"parameterType\":1}],\"queryType\":10,\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"BytesToIP\",\"formatter\":8,\"formatOptions\":{\"palette\":\"gray\"},\"numberFormat\":{\"unit\":2,\"options\":{\"style\":\"decimal\"}}},{\"columnMatch\":\"BytesFromIP\",\"formatter\":8,\"formatOptions\":{\"palette\":\"gray\"},\"numberFormat\":{\"unit\":2,\"options\":{\"style\":\"decimal\"}}},{\"columnMatch\":\"TotalBytes\",\"formatter\":8,\"formatOptions\":{\"palette\":\"grayBlue\"},\"numberFormat\":{\"unit\":2,\"options\":{\"style\":\"decimal\"}}},{\"columnMatch\":\"Group\",\"formatter\":1}],\"rowLimit\":10000},\"tileSettings\":{\"showBorder\":false,\"titleContent\":{\"columnMatch\":\"IP_s\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"inbytes\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}}},\"conditionalVisibility\":{\"parameterName\":\"IPExternalSearch\",\"comparison\":\"isNotEqualTo\"},\"name\":\"IP Search - Copy\",\"styleSettings\":{\"showBorder\":true}}]},\"conditionalVisibility\":{\"parameterName\":\"currentTab\",\"comparison\":\"isEqualTo\",\"value\":\"Search\"},\"name\":\"Search Feature\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"164c4e18-f65b-4f15-ba2a-982bbcf26573\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"TopRows\",\"label\":\"# of Top Processes\",\"type\":2,\"isRequired\":true,\"typeSettings\":{\"additionalResourceOptions\":[],\"showDefault\":false},\"jsonData\":\"[\\r\\n { \\\"value\\\": \\\"10\\\", \\\"label\\\": \\\"10\\\", \\\"selected\\\":true },\\r\\n { \\\"value\\\": \\\"50\\\", \\\"label\\\": \\\"50\\\"},\\r\\n { \\\"value\\\": \\\"100\\\", \\\"label\\\": \\\"100\\\"}\\r\\n]\",\"timeContext\":{\"durationMs\":86400000},\"value\":\"100\"},{\"id\":\"340cce41-bf6e-4a18-a394-eeadf4820e72\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"HashSearch\",\"label\":\"Search for a Process Name or Hash\",\"type\":1,\"value\":\"\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - 1\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SummariesDeviceProcessEvents_CL\\r\\n| where isempty(tostring(\\\"{HashSearch}\\\")) or SHA1_s == \\\"{HashSearch}\\\"\\r\\n| summarize TotalSeen = sum(TotalSeen_d), DevicesSeen = sum(DevicesSeen_d) by SHA1_s, FileName_s, FileSize_s\\r\\n| project FileName = FileName_s, SHA1 = SHA1_s, FileSize= FileSize_s, DevicesSeen, TotalSeen\\r\\n| sort by TotalSeen\\r\\n| top {TopRows} by TotalSeen\",\"size\":0,\"title\":\"Top Processes Seen: select a Process to see trends\",\"timeContextFromParameter\":\"TimeRange\",\"exportFieldName\":\"SHA1\",\"exportParameterName\":\"SHA1_s\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"FileSize\",\"formatter\":0,\"numberFormat\":{\"unit\":36,\"options\":{\"style\":\"decimal\"}}},{\"columnMatch\":\"DevicesSeen\",\"formatter\":8,\"formatOptions\":{\"palette\":\"gray\"}},{\"columnMatch\":\"TotalSeen\",\"formatter\":8,\"formatOptions\":{\"palette\":\"grayBlue\"}},{\"columnMatch\":\"inbytes\",\"formatter\":8,\"formatOptions\":{\"palette\":\"gray\"},\"numberFormat\":{\"unit\":2,\"options\":{\"style\":\"decimal\"}}},{\"columnMatch\":\"outbytes\",\"formatter\":8,\"formatOptions\":{\"palette\":\"gray\"},\"numberFormat\":{\"unit\":2,\"options\":{\"style\":\"decimal\"}}},{\"columnMatch\":\"total_bytes\",\"formatter\":8,\"formatOptions\":{\"palette\":\"grayBlue\"},\"numberFormat\":{\"unit\":2,\"options\":{\"style\":\"decimal\"}}},{\"columnMatch\":\"Group\",\"formatter\":1}]},\"tileSettings\":{\"showBorder\":false,\"titleContent\":{\"columnMatch\":\"IP_s\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"inbytes\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}}},\"name\":\"Top Seen Processes\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let starttime = {TimeRange:start};\\r\\nlet endtime = {TimeRange:end};\\r\\nlet hash = \\\"{SHA1_s}\\\";\\r\\nlet totalseen = SummariesDeviceProcessEvents_CL\\r\\n| where SHA1_s == hash\\r\\n| extend type = \\\"Total Occurences\\\"\\r\\n| make-series Count = sum(TotalSeen_d) on TimeGenerated from starttime to endtime step 1h by type;\\r\\nSummariesDeviceProcessEvents_CL\\r\\n| where SHA1_s == hash\\r\\n| extend type = \\\"Devices Seen\\\"\\r\\n| make-series  Count = sum(DevicesSeen_d) on TimeGenerated from starttime to endtime step 1h by type\\r\\n| union totalseen\\r\\n| render timechart\",\"size\":0,\"aggregation\":2,\"title\":\"Trend of Selected Process\",\"color\":\"lightBlue\",\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"chartSettings\":{\"seriesLabelSettings\":[{\"seriesName\":\"Total Occurences\",\"color\":\"blueDark\"},{\"seriesName\":\"Devices Seen\",\"color\":\"greenDarkDark\"},{\"seriesName\":\"bytes\",\"color\":\"grayBlue\"}]}},\"conditionalVisibility\":{\"parameterName\":\"SHA1_s\",\"comparison\":\"isNotEqualTo\"},\"name\":\"Trends of Selected Process\"}]},\"conditionalVisibility\":{\"parameterName\":\"currentTab\",\"comparison\":\"isEqualTo\",\"value\":\"Process\"},\"name\":\"Top - Processes\"}],\"isLocked\":false,\"fallbackResourceIds\":[\"/subscriptions/5332aa87-652c-4714-b0a1-2d2cb3952428/resourcegroups/securityops/providers/microsoft.operationalinsights/workspaces/secops\"],\"fromTemplateId\":\"sentinel-UserWorkbook\"}",
        "version": "1.0",
        "sourceId": "[parameters('workbookSourceId')]",
        "category": "[parameters('workbookType')]"
      }
    }
  ],
  "outputs": {
    "workbookId": {
      "type": "string",
      "value": "[resourceId( 'microsoft.insights/workbooks', parameters('workbookId'))]"
    }
  },
  "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#"
}